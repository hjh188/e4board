#!/bin/bash

NAME="e4board"                                               # Name of the application
DJANGODIR=/home/eboard/env_e4board/e4board             # Django project directory
BIND_ADDRESS=127.0.0.1:9572                                               # we will communicte HOST:PORT
USER=e4board                                                       # the user to run as
GROUP=e4board                                                      # the group to run as
CPU_CORE=`grep -c ^processor /proc/cpuinfo`
NUM_WORKERS=$((CPU_CORE*2 + 1))
NUM_WORKERS=21
DJANGO_SETTINGS_MODULE=e4board.settings                          # which settings file should Django use
DJANGO_WSGI_MODULE=e4board.wsgi                                  # WSGI module name
WORKER_CLASS=gevent
MAX_REQUESTS=10000
LEVEL=error

echo "Starting $NAME as `whoami`"

# Activate the virtual environment
cd $DJANGODIR
source ../bin/activate
export DJANGO_SETTINGS_MODULE=$DJANGO_SETTINGS_MODULE
export PYTHONPATH=$DJANGODIR:$PYTHONPATH

# Start your Django Unicorn
# Programs meant to be run under supervisor should not daemonize themselves (do not use --daemon)
exec ../bin/gunicorn ${DJANGO_WSGI_MODULE}:application \
  --name $NAME \
  --workers $NUM_WORKERS \
  --user=$USER --group=$GROUP \
  --bind=$BIND_ADDRESS \
  --log-level=$LEVEL \
  --worker-class=$WORKER_CLASS \
  --max-requests $MAX_REQUESTS
  --log-file=-

